# Project documentation

## Project structure
- `//src/wha.tsx` - shitty script for stripping svg's viewBox
- `//src/test.tsx` - old entrypoint, contains some code related to history walk
- `//src/test.module.css` - unused, I think?
- `//src/sprite.gen.ts` - autogenerated metadata for css sprite (`//public/sprite.svg`)
- `//src/index.tsx` - main solid entrypoint
- `//src/index.css` - main css stylesheet, Tailwind 4 settings
- `//src/Root.tsx` - solid root component, contains shitty `<img>` for DnD transfer
- `//src/rfc6902/` - [RFC 6902](https://datatracker.ietf.org/doc/html/rfc6902) implementation, was used for history walk
- `//src/components/` - shadcn and other basic components
- `//src/app/index.tsx` - main app entrypoint
- `//src/app/ui/` - application's ui components
- `//src/app/state/` - shared state type defs
- `//src/app/history/` - code related to history walk
- `//src/app/elements/` - canvas elements
- `//src/app/controllers/` - various dom controllers
- `//src/app/context/` - canvas state context definition

## Controllers
- `DragController` used for dragging activation using pointer events
- `MoveController` used to move elements on the canvas
- `ResizeController` used to resize elements on the canvas
- `ZoomController` used to zoom and pan the canvas

## How elements works
Each element has at least two files, `panel.tsx` and `index.tsx` (`panel.tsx` is re-exported from `index.tsx`)
`panel.tsx` contains the code for rendering the sidebar that the user uses to change various settings for the elements

Basically, each element is a move and resize controller, a few hooks (and it should be refactored since this is a boilerplate),
and an svg group containing the elements to draw on the canvas

Some elements (like `SquareTable`) are turned upside down so that they resize upwards

Each element state should be added to union in `//src/app/elements/index.tsx`

## Near refactoring TODO list
- Remove all @ts-expect-error's early inserting type assertions (via typeguards for example) where types cannot be inferred
- Wrap all canvas elements boilerplate in a wrapper component utility

# Notes
- WebKit (Safari, for example) browsers doesn't support svg `<use>` well. Because of that, canvas overlay (for fancy dragndrop) is disabled for the webkit.
  TLDR: WebKit rerenders the `<use>` svg element (whose content or position may change at **any time**) only **sometimes**
- Solid is not React, it's a reactive framework where all dynamic things are done by rendering them in an effect, where a signal (like state in React) subscribes the effect to self-updates (of the signal).
  It also doesn't use virtual DOM, all components are mounted directly on DOM, thus you, for example, can do something like `<div>{document.createElement('a')}</div>`
- Use eslint. Since it has linting rules for Solid, it can save you time by suggesting where you incorrectly use Solid
- Read [Solid docs](https://docs.solidjs.com/concepts/intro-to-reactivity) (Learn and Reference)
- Solid transformer (`dom-expressions`) sometimes *incorrectly* assumes that expression is reactive (okay, that's obvious, since any field access or function call can be a signal).
  When you don't need reactivity somewhere (like here: ```<use href={/* @once */ `#${CANVAS_FOCUS_ID}`} />```), use can use [`@once`](https://docs.solidjs.com/reference/jsx-attributes/once)
